<html lang="pt-br">
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>LeCard | Order Printer v1</title>
    <link rel="stylesheet" href="assets/bootstrap.min.css">
    <link rel="stylesheet" href="assets/animate.css">
    <style>
    	.circle {
    		width: 16px;
    		height: 16px;
    		border-radius: 8px;
    		position: absolute;
            background-color:  #dc3545;
    	}
    	.circle.ativo {
    		background-color: #28a745;
    	}
    	.logs {
    		height: 60vh;
    		overflow: auto;
    	}
    </style>
  </head>
  <body>
    <div id="app" class="container-fluid mt-3">
        <div class="row">
            <div class="col-5">
                <h6 class="mb-3">Status da Conexāo</h6>
                <ul class="list-group small">
                    <li class="list-group-item">
                        <span class="circle" :class="{'ativo': conectado}">&nbsp;</span>
                        <span style="padding-left: 26px">Conectado ao servidor</span>
                    </li>
                    <li class="list-group-item">
                        <span class="circle" :class="{'ativo': printerConectada}">&nbsp;</span>
                        <span style="padding-left: 26px">Impressora conectada</span>
                    </li>
                </ul>
                <!-- <div class="small mt-4">
                  <div class="p-1"><b>Empresa:</b> <br> {{dados.razao_social}}</div>
                  <div class="p-1"><b>Plano:</b>  <br> {{dados.nome_plano}}</div>
                </div> -->
            </div>
            <div class="col-7">
                <h6 class="mb-3">Logs</h6>
                <div class="card px-2 py-1 logs mb-3 small">
                    <div class="mt-1" v-for="m in messages">
                        <b>{{m.time}}</b>
                        {{m.description}}
                    </div>
                </div>
                <button class="btn btn-block btn-secondary" @click="testeImpressao">Teste de Impressāo</button>
            </div>
        </div>

    </div>

    <script src="assets/vue.js"></script>
    <script src="assets/socket.io.js"></script>
    <script>
        var empresa = 1;
        var socket = io('https://softcomanda.herokuapp.com/' + empresa);

        var app = new Vue({
            el: '#app',
            data: {
                messages: [],
                conectado: false,
                printerConectada: false,

                dados: {
                    razao_social: "Stork Digital",
                    nome_plano: "Smart Cozinha"
                },

                printer: { 
                    layout: 'pedido',
                    copies: 1,
                    printer: {
                        ip: '192.168.0.101',
                        port: 9000
                    },
                    data: {
                    	"nome_empresa": "Stork Digital",
                    	"id_comanda_produto":"244",
                    	"nome_produto":"One Bacon",
                    	"nome_tabela":"",
                    	"quantidade":"1",
                    	"data_pedido":"19\/06\/2019 - 08:20",
                    	"tipo":"Delivery",
                    	"observacao":"Pouca cebola",
                    	"adicionais":"Hamburguer Artesanal, +Cheddar",
                    	"remocoes":"Milho"
                    }
                }
            },
            
            methods: {
                testeImpressao() {
                    socket.emit('print_order', this.printer);
                }
            },

            created() {
                socket.on('connect', () => {
                    this.conectado = true;
                });

                socket.on('message', res => {
                    this.messages.push(res.data)
                });

                socket.on('connect_printer', res => {
                    console.log(res);
                    this.printerConectada = res;
                });                
                
                socket.on('disconnect', function(){
                    this.conectado = false;
                });
            }
        })
    </script>

  </body>
</html>